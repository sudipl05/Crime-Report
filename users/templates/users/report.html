<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Report a Crime</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex justify-center items-center min-h-screen">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-6 border-b-4 border-blue-500 pb-2">
            Report a Crime
        </h2>

        <form method="post" enctype="multipart/form-data" class="space-y-4">
            {% csrf_token %}

            <!-- Title Field -->
            <label for="id_title" class="block text-gray-700 font-medium">Title</label>
            <select id="id_title" name="title" required
                class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-blue-500 transition">
                <option value="" disabled selected>Select a crime type</option>
                <option value="Theft">Theft</option>
                <option value="Assault">Assault</option>
                <option value="Robbery">Robbery</option>
                <option value="Cyber Crime">Cyber Crime</option>
                <option value="Other">Other</option>
            </select>

            <!-- Description Field -->
            <label for="id_description" class="block text-gray-700 font-medium">Description</label>
            <textarea id="id_description" name="description" rows="4" required
                class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-blue-500 transition"></textarea>
            <!-- Location Field -->
            <label for="id_location" class="block text-gray-700 font-medium">Location</label>
            <input type="text" id="id_location" name="location" required
                class="w-full px-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-blue-500 transition">

            <!-- Photo Upload -->
            <label for="id_photos" class="block text-gray-700 font-medium">Upload Photos</label>
            <input type="file" id="id_photos" name="photos" accept="image/*" multiple
                class="w-full border-2 border-gray-300 rounded-md px-4 py-2 transition">

            <!-- Photo Previews -->
            <div id="photo-preview" class="flex flex-wrap gap-2 mt-2"></div>

            <!-- Video Upload -->
            <label for="id_videos" class="block text-gray-700 font-medium">Upload Videos</label>
            <input type="file" id="id_videos" name="videos" accept="video/*" multiple
                class="w-full border-2 border-gray-300 rounded-md px-4 py-2 transition">

            <!-- Video Previews -->
            <div id="video-preview" class="flex flex-wrap gap-2 mt-2"></div>



            <!-- Submit Button -->
            <button type="submit"
                class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300">
                üöî Submit Report
            </button>
        </form>

        <div class="text-center mt-6">
            <a href="{% url 'dashboard' %}" 
               class="text-blue-500 font-medium hover:text-blue-600 transition">
                ‚Üê Back to Dashboard
            </a>
        </div>
    </div>

    <!-- Script for image and video previews -->
    <script>
        // Photo Preview
        document.getElementById('id_photos').addEventListener('change', function (event) {
            const previewContainer = document.getElementById('photo-preview');
            previewContainer.innerHTML = ''; // Clear previous previews

            const files = event.target.files;
            for (let i = 0; i < files.length; i++) {
                const file = files[i];

                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'w-24 h-24 object-cover rounded border-2 border-gray-300';
                        previewContainer.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                }
            }
        });

        // Video Preview
        document.getElementById('id_videos').addEventListener('change', function (event) {
            const previewContainer = document.getElementById('video-preview');
            previewContainer.innerHTML = ''; // Clear previous previews

            const files = event.target.files;
            for (let i = 0; i < files.length; i++) {
                const file = files[i];

                if (file.type.startsWith('video/')) {
                    const videoElement = document.createElement('video');
                    const videoThumbnail = document.createElement('canvas');
                    const videoURL = URL.createObjectURL(file);

                    // Load video metadata
                    videoElement.src = videoURL;
                    videoElement.onloadedmetadata = function () {
                        // Set video playback to the first frame
                        videoElement.currentTime = 0;
                    };

                    // Wait for the video to seek to the first frame
                    videoElement.onseeked = function () {
                        // Set up the canvas size to match the video
                        videoThumbnail.width = videoElement.videoWidth / 2;
                        videoThumbnail.height = videoElement.videoHeight / 2;

                        // Draw the first frame on the canvas
                        videoThumbnail.getContext('2d').drawImage(videoElement, 0, 0, videoThumbnail.width, videoThumbnail.height);

                        // Create an image from the canvas (thumbnail)
                        const thumbnailImage = document.createElement('img');
                        thumbnailImage.src = videoThumbnail.toDataURL();
                        thumbnailImage.className = 'w-24 h-24 object-cover rounded border-2 border-gray-300';

                        // Append the thumbnail image to the preview container
                        previewContainer.appendChild(thumbnailImage);
                    };
                }
            }
        });
        // Prevent double submission
        document.querySelector('form').addEventListener('submit', function (e) {
            const submitBtn = this.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.innerText = 'Submitting...';
                submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        });
    </script>
</body>
</html>
